---
- name: Bootstrap SSH key-based access and basic packages
  hosts: k0s_cluster
  gather_facts: false
  become: false

  vars:
    public_key_path: "~/.ssh/id_rsa.pub"

  pre_tasks:
    - name: Ensure Python is installed (needed for Ansible)
      raw: |
        if command -v python3 >/dev/null 2>&1; then exit 0; fi
        if command -v apt-get >/dev/null 2>&1; then
          apt-get update && apt-get install -y python3
        elif command -v apk >/dev/null 2>&1; then
          apk add --no-cache python3
        fi
      changed_when: false

    - name: Gather facts now that Python is present
      setup:

  roles:
    - common
