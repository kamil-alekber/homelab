---
apiVersion: v1
kind: ConfigMap
metadata:
  name: olivetin-config
  namespace: default
data:
  config.yaml: |
    actions:
      - title: "Hello world!"
        shell: echo 'Hello World!'
      
      - title: "Restart k3s server"
        shell: systemctl restart k3s

      - title: "Check cluster status"
        shell: kubectl get nodes

      - title: "Add Traefik Route"
        shell: |-
          ssh root@192.168.8.213 "cat > /etc/traefik/confg.d/{{ serviceName }}.yaml" <<'EOF'
          http:
            routers:
              {{ serviceName }}-router:
                rule: Host(\`{{ hostname }}\`)
                service: {{ serviceName }}-service
                tls:
                  certResolver: letsencrypt

            services:
              {{ serviceName }}-service:
                loadBalancer:
                  servers:
                    - url: {{ loadBalancerUrl }}
          EOF
        arguments:
          - name: serviceName
            type: ascii_sentence
            title: Service Name
            description: Name of the service (e.g., my-app)
          - name: hostname
            title: Hostname
            type: ascii_sentence
            description: Full hostname for the route (e.g., myapp.example.com)
          - name: loadBalancerUrl
            title: Load Balancer URL
            type: url
            description: Backend service URL (e.g., http://192.168.8.100:8080)
