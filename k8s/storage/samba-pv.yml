---
# PersistentVolume for Samba Media Storage
apiVersion: v1
kind: PersistentVolume
metadata:
  name: samba-media-pv
spec:
  capacity:
    storage: 1Ti  # Adjust based on your actual storage size
  accessModes:
    - ReadWriteMany  # Multiple pods can read/write simultaneously
  persistentVolumeReclaimPolicy: Retain
  storageClassName: samba-storage
  mountOptions:
    - dir_mode=0777
    - file_mode=0666
    - uid=1000
    - gid=1000
    - nobrl  # Disable byte-range locks for better performance
    - mfsymlinks
    - cache=loose
  csi:
    driver: smb.csi.k8s.io
    readOnly: false
    volumeHandle: samba-media-volume
    volumeAttributes:
      source: "//storage-01/media"  # Update to match your storage node IP or hostname
    nodeStageSecretRef:
      name: samba-credentials
      namespace: storage
---
# PersistentVolume for Samba Shared Storage
apiVersion: v1
kind: PersistentVolume
metadata:
  name: samba-shared-pv
spec:
  capacity:
    storage: 500Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: samba-storage
  mountOptions:
    - dir_mode=0777
    - file_mode=0666
    - uid=1000
    - gid=1000
    - nobrl
    - mfsymlinks
    - cache=loose
  csi:
    driver: smb.csi.k8s.io
    readOnly: false
    volumeHandle: samba-shared-volume
    volumeAttributes:
      source: "//storage-01/shared"
    nodeStageSecretRef:
      name: samba-credentials
      namespace: storage
---
# Alternative: PV using CIFS directly (without CSI driver)
# Use this if you don't have SMB CSI driver installed
apiVersion: v1
kind: PersistentVolume
metadata:
  name: samba-media-pv-cifs
spec:
  capacity:
    storage: 1Ti
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: samba-cifs
  mountOptions:
    - vers=3.0
    - dir_mode=0777
    - file_mode=0666
    - uid=1000
    - gid=1000
    - nobrl
  csi:
    driver: cifs.csi.k8s.io
    readOnly: false
    volumeHandle: samba-media-cifs
    volumeAttributes:
      source: "//192.168.1.20/media"  # Update with your storage-01 IP
    nodeStageSecretRef:
      name: samba-credentials
      namespace: storage
